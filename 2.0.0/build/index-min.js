/*! kheatmap - v2.0.0 - 2013-09-23 5:06:15 PM
* Copyright (c) 2013 oldj; Licensed  */
KISSY.add("kg/kheatmap/2.0.0/index",function(a,b,c){function d(a,b,c){var e=this;d.superclass.constructor.call(e,a,b,c),this.canvas=a,this.width=b,this.height=c,this._init()}function e(a,b){var c,d,e,g,h,i,j,k=256,l=[],m=Math.floor(k*a),n=Math.floor(k*b);for(c=0;m>c;c++)d=n>1?Math.floor(256*c/(n-1)):255,d>255&&(d=255),g=[0,0,255,d],l.push(g);for(c=m;k>c;c++)h=240*(k-c-1)/(k-m-1),i=1,j=.5,e=f(h,i,j),d=n>1?Math.floor(256*c/(n-1)):255,d>255&&(d=255),g=[e[0],e[1],e[2],d],l.push(g);return l}function f(a,b,c){if(b>0){var d,e,f=1/3,g=1/6,h=2/3,i=.5>c?c*(1+b):1+b-c*b,j=2*c-i,k=a/360,l=k+f,m=k-f,n=[l,k,m];for(d=0;3>d;d++)e=n[d],0>e&&(e+=1),e>1&&(e-=1),n[d]=e;for(d=0;3>d;d++)e=n[d],e=g>e?j+6*(i-j)*e:.5>e?i:h>e?6*(i-j)*(h-e):j,n[d]=e;for(d=0;3>d;d++)n[d]=Math.floor(256*n[d])}else n=[c,c,c];return n}function g(a,b){function c(a,c,d){var f,g,h=[[a,c],[-a,c],[a,-c],[-a,-c],[c,a],[-c,a],[c,-a],[-c,-a]];for(f=0;8>f;f++)g=b*h[f][1]+h[f][0],e[g]=d||1}for(var d,e={},f=0,g=a,h=3-(a<<1);g>=f;){for(d=f;g+1>d;d++)c(f,d,g+1-d);0>h?h+=(f<<2)+6:(h+=(f-g<<2)+10,g--),f++}var i,j=[];for(i in e)e.hasOwnProperty(i)&&j.push([parseInt(i),e[i]]);return j}return b.all,d.prototype={_init:function(){this.canvas.width=this.width,this.canvas.height=this.height,this._ctx=this.canvas.getContext("2d"),this._colors=e(.382,.618),this._circle=g(16,this.width),this.clear()},addData:function(a){var b,c,d,e=a.length,f=this.width,g=this._size;if(0!=e){for(b=0;e>b;b++)c=a[b],d=c[1]*f+c[0],isNaN(d)||d>=g||this._heat(d,c[2]||1);this._is_flat=!1}},_heat:function(a,b){this._original_points[a]+=b;var c,d,e,f=this._original_points,g=this._circle,h=g.length,i=this._size;for(c=0;h>c;c++)d=g[c],e=a+d[0],0>e||e>=i||(f[e]+=d[1])},_newEmptyArray:function(a){for(var b=[];a--;)b.push(0);return b},clear:function(){this._is_flat=!1,this._size=this.width*this.height,this._original_points=this._newEmptyArray(this._size),this._flat_points=this._newEmptyArray(this._size)},_findMax:function(a){var b,c,d,e=0;try{e=Math.max.apply(null,a)}catch(f){for(b=0,c=a.length;c>b;b++)(d=a[b])>e&&(e=d)}return e},_doFlat:function(){if(!this._is_flat){var a,b=this._findMax(this._original_points),c=255/b,d=this._size,e=this._flat_points,f=this._original_points;for(a=0;d>a;a++)e[a]=Math.floor(f[a]*c);this._is_flat=!0}},render:function(){this._doFlat();var a,b,c,d=this.width,e=this.height,f=this._ctx.createImageData(d,e),g=f.data,h=this._size,i=this._flat_points,j=this._colors;for(a=0;h>a;a++)b=j[i[a]],c=4*a,g[c]=b[0],g[c+1]=b[1],g[c+2]=b[2],g[c+3]=b[3];this._ctx.putImageData(f,0,0)}},a.extend(d,c,{},{ATTRS:{}}),d},{requires:["node","base"]});